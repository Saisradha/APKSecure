# Deploy APKSecure (backend + OTP) on Render

## 1) Fork or push this repo

## 2) Configure environment variables

### For Local Development:
Create a `.env` file in your project root with:
```env
APKSECURE_SECRET=your-secret-key
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-16-character-app-password
SMTP_FROM=your-email@gmail.com
ALLOW_ORIGIN=*
```

### For Render Deployment:
**IMPORTANT**: Render's free tier **blocks SMTP connections** (ports 25, 465, 587). Use **SendGrid API** instead (uses HTTP, not SMTP).

After deploying, go to your Render service → **Environment** tab and add:

**Option 1: SendGrid (Recommended for Render free tier):**
- **`SENDGRID_API_KEY`**: Your SendGrid API key (see SendGrid setup below)
- **`SMTP_FROM`**: Your verified sender email (e.g., `noreply@yourdomain.com` or your personal email)

**Option 2: Gmail SMTP (Only works on paid Render plans or localhost):**
- **`SMTP_USER`**: Your Gmail email address
- **`SMTP_PASS`**: Your Gmail App Password - the 16-character password
- **`SMTP_FROM`**: Your Gmail email

**Other variables (already configured):**
- **`APKSECURE_SECRET`**: Already auto-generated by render.yaml
- **`ALLOW_ORIGIN`**: Already set to `*` in render.yaml
- **`SMTP_HOST`** and **`SMTP_PORT`**: Set in render.yaml (for Gmail fallback)

**Why it works locally but not on Render**: The `.env` file is NOT deployed to Render. You must manually set environment variables in Render's dashboard. Also, Render free tier blocks SMTP ports.

## 3) One‑click Render deploy
- Connect repo to Render and select `render.yaml` from this repo.
- Render builds with `pip install -r requirements.txt` and starts Gunicorn.
- Health check: `/health` should return `{ "status": "ok" }`.

## 4) Point frontend to backend
- Host your static site (GitHub Pages or Render Static Site).
- The frontend calls `/auth/*`, `/api/*`, `/events` on the same origin by default.
- If hosting separately, set `ALLOW_ORIGIN` on the backend to your frontend domain.

## 5) Email Service Setup

### Option A: SendGrid (Recommended for Render free tier)
1. Sign up at [sendgrid.com](https://sendgrid.com) (free tier: 100 emails/day)
2. Verify your sender email:
   - Go to **Settings** → **Sender Authentication**
   - Click **Verify a Single Sender**
   - Enter your email and verify via email link
3. Create API Key:
   - Go to **Settings** → **API Keys**
   - Click **Create API Key**
   - Name it "APKSecure" and give it **Mail Send** permissions
   - Copy the API key (you'll only see it once!)
4. Set in Render: Add `SENDGRID_API_KEY` environment variable with your API key
5. Set `SMTP_FROM` to your verified sender email

### Option B: Gmail SMTP (Works locally, but NOT on Render free tier)
1. Go to your Google Account settings
2. Enable **2-Step Verification** (if not already enabled)
3. Navigate to **Security** → **2-Step Verification** → **App passwords**
4. Select **App: Mail** and **Device: Other (Custom name)** → Enter "APKSecure"
5. Click **Generate** and copy the 16-character password
6. Set in Render: Add `SMTP_USER` (your Gmail) and `SMTP_PASS` (the app password)

**Important**: 
- For Render free tier: Use SendGrid (Option A)
- For localhost: Either SendGrid or Gmail works
- Use App Password for Gmail, NOT your regular password!

## 6) Test
- Visit backend URL: `/health`.
- Open your site → enter email → “Send Code” → check your inbox.
